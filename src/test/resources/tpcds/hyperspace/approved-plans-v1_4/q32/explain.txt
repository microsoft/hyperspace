== Physical Plan ==
CollectLimit 100
+- *(13) Project [1 AS excess discount amount #1]
   +- *(13) SortMergeJoin [cs_sold_date_sk#2], [d_date_sk#3], Inner
      :- *(10) Sort [cs_sold_date_sk#2 ASC NULLS FIRST], false, 0
      :  +- Exchange hashpartitioning(cs_sold_date_sk#2, 5)
      :     +- *(9) Project [cs_sold_date_sk#2]
      :        +- *(9) SortMergeJoin [i_item_sk#4], [cs_item_sk#5#6], Inner, (cast(cs_ext_discount_amt#7 as decimal(14,7)) > (CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(cs_ext_discount_amt) AS DECIMAL(11,6)))#8)
      :           :- *(3) Project [cs_sold_date_sk#2, cs_ext_discount_amt#7, i_item_sk#4]
      :           :  +- *(3) SortMergeJoin [cs_item_sk#5], [i_item_sk#4], Inner
      :           :     :- *(1) Project [cs_sold_date_sk#2, cs_item_sk#5, cs_ext_discount_amt#7]
      :           :     :  +- *(1) Filter ((isnotnull(cs_item_sk#5) && isnotnull(cs_ext_discount_amt#7)) && isnotnull(cs_sold_date_sk#2))
      :           :     :     +- *(1) FileScan Hyperspace(Type: CI, Name: JoinIndex27-index-10-cs_item_sk-22, LogVersion: 0) default.catalog_sales[cs_sold_date_sk#2,cs_item_sk#5,cs_ext_discount_amt#7] Batched: true, Format: Parquet, Location: InMemoryFileIndex[], PartitionFilters: [], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_ext_discount_amt), IsNotNull(cs_sold_date_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_item_sk:int,cs_ext_discount_amt:decimal(7,2)>, SelectedBucketsCount: 200 out of 200
      :           :     +- *(2) Project [i_item_sk#4]
      :           :        +- *(2) Filter ((isnotnull(i_manufact_id#9) && (i_manufact_id#9 = 977)) && isnotnull(i_item_sk#4))
      :           :           +- *(2) FileScan Hyperspace(Type: CI, Name: JoinIndex08-index-2-i_item_sk-17, LogVersion: 0) default.item[i_item_sk#4,i_manufact_id#9] Batched: true, Format: Parquet, Location: InMemoryFileIndex[], PartitionFilters: [], PushedFilters: [IsNotNull(i_manufact_id), EqualTo(i_manufact_id,977), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_manufact_id:int>, SelectedBucketsCount: 200 out of 200
      :           +- *(8) Sort [cs_item_sk#5#6 ASC NULLS FIRST], false, 0
      :              +- Exchange hashpartitioning(cs_item_sk#5#6, 200)
      :                 +- *(7) Filter isnotnull((CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(cs_ext_discount_amt) AS DECIMAL(11,6)))#8)
      :                    +- *(7) HashAggregate(keys=[cs_item_sk#5], functions=[avg(UnscaledValue(cs_ext_discount_amt#7))])
      :                       +- Exchange hashpartitioning(cs_item_sk#5, 5)
      :                          +- *(6) HashAggregate(keys=[cs_item_sk#5], functions=[partial_avg(UnscaledValue(cs_ext_discount_amt#7))])
      :                             +- *(6) Project [cs_item_sk#5, cs_ext_discount_amt#7]
      :                                +- *(6) SortMergeJoin [cs_sold_date_sk#2], [d_date_sk#3], Inner
      :                                   :- *(4) Project [cs_sold_date_sk#2, cs_item_sk#5, cs_ext_discount_amt#7]
      :                                   :  +- *(4) Filter (isnotnull(cs_sold_date_sk#2) && isnotnull(cs_item_sk#5))
      :                                   :     +- *(4) FileScan Hyperspace(Type: CI, Name: JoinIndex26-index-6-cs_sold_date_sk-26, LogVersion: 0) default.catalog_sales[cs_sold_date_sk#2,cs_item_sk#5,cs_ext_discount_amt#7] Batched: true, Format: Parquet, Location: InMemoryFileIndex[], PartitionFilters: [], PushedFilters: [IsNotNull(cs_sold_date_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_item_sk:int,cs_ext_discount_amt:decimal(7,2)>, SelectedBucketsCount: 200 out of 200
      :                                   +- *(5) Project [d_date_sk#3]
      :                                      +- *(5) Filter (((isnotnull(d_date#10) && (cast(d_date#10 as string) >= 2000-01-27)) && (d_date#10 <= 11073)) && isnotnull(d_date_sk#3))
      :                                         +- *(5) FileScan Hyperspace(Type: CI, Name: JoinIndex03-index-0-d_date_sk-10, LogVersion: 0) default.date_dim[d_date_sk#3,d_date#10] Batched: true, Format: Parquet, Location: InMemoryFileIndex[], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), LessThanOrEqual(d_date,2000-04-26), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_date:date>, SelectedBucketsCount: 200 out of 200
      +- *(12) Sort [d_date_sk#3 ASC NULLS FIRST], false, 0
         +- Exchange hashpartitioning(d_date_sk#3, 5)
            +- *(11) Project [d_date_sk#3]
               +- *(11) Filter (((isnotnull(d_date#10) && (cast(d_date#10 as string) >= 2000-01-27)) && (d_date#10 <= 11073)) && isnotnull(d_date_sk#3))
                  +- *(11) FileScan Hyperspace(Type: CI, Name: FilterIndex06-index-14-d_date-2, LogVersion: 0) default.date_dim[d_date_sk#3,d_date#10] Batched: true, Format: Parquet, Location: InMemoryFileIndex[], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), LessThanOrEqual(d_date,2000-04-26), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_date:date>